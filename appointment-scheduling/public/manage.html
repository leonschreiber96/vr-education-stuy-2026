<!doctype html>
<html lang="de">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Termin verwalten - Terminfindung</title>
      <link rel="icon" type="image/svg+xml" href="favicon.svg" />
      <link rel="stylesheet" href="css/manage.css" />
   </head>
   <body>
      <div class="container">
         <div class="header">
            <h1>ğŸ“… Termine verwalten</h1>
            <p>Ã„ndern oder stornieren Sie Ihre Termine</p>
         </div>

         <div class="content" id="mainContent">
            <div id="alertContainer"></div>

            <!-- Token Input Section -->
            <div id="tokenInputSection">
               <div class="token-input-container">
                  <h2 style="color: #667eea; margin-bottom: 20px">
                     Bitte geben Sie Ihren BestÃ¤tigungscode ein
                  </h2>
                  <p style="color: #666; margin-bottom: 20px">
                     Dieser Code wurde Ihnen per E-Mail zugeschickt.
                  </p>
                  <input
                     type="text"
                     id="tokenInput"
                     placeholder="BestÃ¤tigungscode eingeben"
                  />
                  <button class="btn btn-primary" onclick="loadBookings()">
                     Termine laden
                  </button>
               </div>
            </div>

            <!-- Loading Section -->
            <div id="loadingSection" class="loading" style="display: none">
               <div class="loading-spinner"></div>
               <p>Termine werden geladen...</p>
            </div>

            <!-- Bookings Details Section -->
            <div id="bookingsSection" style="display: none">
               <!-- Participant Info -->
               <div class="section">
                  <h2>Ihre Daten</h2>
                  <div class="info-card">
                     <div class="info-row">
                        <span class="info-label">Name:</span>
                        <span class="info-value" id="participantName"></span>
                     </div>
                     <div class="info-row">
                        <span class="info-label">E-Mail:</span>
                        <span class="info-value" id="participantEmail"></span>
                     </div>
                  </div>
               </div>

               <!-- Primary Appointment -->
               <div class="section">
                  <h2>Haupttermin</h2>
                  <div class="appointment-card">
                     <h3>
                        <span class="appointment-badge badge-primary-type"
                           >Haupttermin</span
                        >
                     </h3>
                     <div class="info-row">
                        <span class="info-label">ğŸ“… Datum:</span>
                        <span class="info-value" id="primaryDate"></span>
                     </div>
                     <div class="info-row">
                        <span class="info-label">ğŸ• Uhrzeit:</span>
                        <span class="info-value" id="primaryTime"></span>
                     </div>
                     <div
                        class="info-row"
                        id="primaryLocationRow"
                        style="display: none"
                     >
                        <span class="info-label">ğŸ“ Ort:</span>
                        <span class="info-value" id="primaryLocation"></span>
                     </div>
                  </div>
                  <div class="btn-group" style="margin-top: 15px">
                     <button
                        class="btn btn-primary"
                        onclick="showRescheduleModal('primary')"
                     >
                        Haupttermin Ã¤ndern
                     </button>
                  </div>
               </div>

               <!-- Follow-up Appointment -->
               <div class="section">
                  <h2>Folgetermin</h2>
                  <div class="appointment-card followup-card">
                     <h3>
                        <span class="appointment-badge badge-followup-type"
                           >Folgetermin</span
                        >
                     </h3>
                     <div class="info-row">
                        <span class="info-label">ğŸ“… Datum:</span>
                        <span class="info-value" id="followupDate"></span>
                     </div>
                     <div class="info-row">
                        <span class="info-label">ğŸ• Uhrzeit:</span>
                        <span class="info-value" id="followupTime"></span>
                     </div>
                     <div
                        class="info-row"
                        id="followupLocationRow"
                        style="display: none"
                     >
                        <span class="info-label">ğŸ“ Ort:</span>
                        <span class="info-value" id="followupLocation"></span>
                     </div>
                     <div class="info-row">
                        <span class="info-label">â±ï¸ Abstand:</span>
                        <span class="info-value" id="followupDaysAfter"></span>
                     </div>
                  </div>
                  <div class="btn-group" style="margin-top: 15px">
                     <button
                        class="btn btn-primary"
                        onclick="showRescheduleModal('followup')"
                     >
                        Folgetermin Ã¤ndern
                     </button>
                  </div>
               </div>

               <!-- Actions -->
               <div class="section">
                  <h2>Aktionen</h2>
                  <div class="alert alert-warning">
                     <strong>Achtung:</strong> Wenn Sie Ihre Teilnahme absagen,
                     werden <strong>beide Termine</strong> storniert. Dies kann
                     nicht rÃ¼ckgÃ¤ngig gemacht werden!
                  </div>
                  <div class="btn-group">
                     <button class="btn btn-danger" onclick="showCancelModal()">
                        Beide Termine absagen
                     </button>
                  </div>
               </div>
            </div>
         </div>

         <div class="footer">
            <p>
               <a href="/">Zur Startseite</a> |
               <a href="/admin.html">Admin Login</a>
            </p>
         </div>
      </div>

      <!-- Reschedule Modal -->
      <div
         id="rescheduleModal"
         class="modal"
         onclick="handleModalBackdropClick(event, 'rescheduleModal')"
      >
         <div class="modal-content" onclick="event.stopPropagation()">
            <button
               class="modal-close"
               onclick="closeRescheduleModal()"
               aria-label="Close"
            >
               &times;
            </button>
            <div class="modal-header">
               <h3 id="rescheduleModalTitle">Termin Ã¤ndern</h3>
            </div>
            <div class="modal-body">
               <div class="info-box" id="rescheduleInfoBox">
                  <h4>Aktueller Termin</h4>
                  <p id="currentAppointmentInfo"></p>
               </div>
               <div id="rescheduleConstraintInfo"></div>
               <div id="rescheduleTimeslotsLoading" class="loading">
                  <div class="loading-spinner"></div>
                  <p>VerfÃ¼gbare Termine werden geladen...</p>
               </div>
               <div
                  id="rescheduleTimeslotsContainer"
                  class="timeslots-container"
                  style="display: none"
               ></div>
            </div>
            <div class="modal-footer">
               <button
                  class="btn btn-secondary"
                  onclick="closeRescheduleModal()"
               >
                  Abbrechen
               </button>
               <button
                  class="btn btn-primary"
                  id="confirmRescheduleBtn"
                  onclick="confirmReschedule()"
                  disabled
               >
                  Ã„nderung bestÃ¤tigen
               </button>
            </div>
         </div>
      </div>

      <!-- Cancel Modal -->
      <div
         id="cancelModal"
         class="modal"
         onclick="handleModalBackdropClick(event, 'cancelModal')"
      >
         <div class="modal-content" onclick="event.stopPropagation()">
            <button
               class="modal-close"
               onclick="closeCancelModal()"
               aria-label="Close"
            >
               &times;
            </button>
            <div class="modal-header">
               <h3>Termine absagen</h3>
            </div>
            <div class="modal-body">
               <div class="alert alert-warning">
                  <strong>Achtung:</strong> Sie sind dabei, Ihre Teilnahme
                  vollstÃ¤ndig abzusagen.
               </div>
               <p>Folgende Termine werden storniert:</p>
               <div class="appointment-card" style="margin-top: 15px">
                  <h4 style="color: #667eea; margin-bottom: 10px">
                     Haupttermin
                  </h4>
                  <p id="cancelPrimaryInfo"></p>
               </div>
               <div
                  class="appointment-card followup-card"
                  style="margin-top: 15px"
               >
                  <h4 style="color: #28a745; margin-bottom: 10px">
                     Folgetermin
                  </h4>
                  <p id="cancelFollowupInfo"></p>
               </div>
               <p style="margin-top: 20px; font-weight: 600">
                  Sind Sie sicher, dass Sie beide Termine absagen mÃ¶chten?
               </p>
            </div>
            <div class="modal-footer">
               <button class="btn btn-secondary" onclick="closeCancelModal()">
                  Abbrechen
               </button>
               <button
                  class="btn btn-danger"
                  id="confirmCancelBtn"
                  onclick="confirmCancel()"
               >
                  Termine absagen
               </button>
            </div>
         </div>
      </div>

      <script src="js/manage.js"></script>
   </body>
</html>
